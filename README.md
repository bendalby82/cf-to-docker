# CF Ripper
Walkthrough: Rip a Cloud Foundry application to Docker.     
## 1. Summary  
Because they follow the [12 factors](https://12factor.net/), Cloud Foundry applications are easy to port to alternative platforms. This walkthrough demonstrates how to introspect a running Cloud Foundry application, and convert it into a running Docker container.
## 2. Prerequisites
1. cf CLI logged into a Cloud Foundry installation where you can push applications and call the API (I used cf version 6.34.1+bbdf81482.2018-01-17 running against PCF Dev version 0.29.0). 
2. docker CLI connected to a running Docker Machine where you can build images and launch containers (I used Docker version 18.02.0-ce, build fc4de44 running against Docker Machine version 0.13.0, build 9ba6da9). 
3. Access to this repository and [Spring Music](https://github.com/cloudfoundry-samples/spring-music) .  

PS: I found a great guide to installing Docker on OSX via Brew at https://pilsniak.com/how-to-install-docker-on-mac-os-using-brew/ . 
## 3. Installing Spring Music on Cloud Foundry  
1. Clone https://github.com/cloudfoundry-samples/spring-music   
2. Follow the instructions to push Spring Music to Cloud Foundry:   
https://github.com/cloudfoundry-samples/spring-music#running-the-application-on-cloud-foundry   
3. Verify you can access the application through your browser:  
<img src="https://github.com/bendalby82/cfripper/blob/master/images/spring-music-pcfdev.png" width="500px" border="1">   

## 4. Download and unpack the application's Droplet from Cloud Foundry   
To do this, you need to first retrieve your application's GUID (See [line 18](https://github.com/bendalby82/cfripper/blob/master/01-make-docker-file-from-cf.sh#L18)), and then make a call to the Cloud Foundry API (see [line 31](https://github.com/bendalby82/cfripper/blob/master/01-make-docker-file-from-cf.sh#L31)) to retrieve the application's droplet:  

<img src="https://github.com/bendalby82/cfripper/blob/master/images/spring-music-cf-api.png" width="500px" border="1">

This isn't very difficult, but you do need to know that the staged droplet is in .tar.gz format. Follow the links above to see the relevant lines in the `01-make-docker-file-from-cf.sh` script.  

## 5. Retrieve useful environment variables from Cloud Foundry
There are a couple of environment variables that we will need if we are to reuse the start command generated by Cloud Foundry's Java buildpack - namely $PORT and $MEMORY_LIMIT, rather than trying to figure it out for ourselves. Unfortunately we don't get PORT back by calling `cf env spring-music`, so I opted instead to query the running container's environment via SSH, and then process that. (See [line 26](https://github.com/bendalby82/cfripper/blob/master/01-make-docker-file-from-cf.sh#L26)).

## 6. Retrieve start command from Cloud Foundry  
When you unpack the staged droplet, you will see an incredibly helpful file called `staging_info.yml` in the root directory. This JSON file magically includes a `start_command` key, which we can use with just a little bit of magic:  





